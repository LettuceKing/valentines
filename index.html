<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ú–æ–µ–π –ª—é–±–∏–º–∫–µ ‚ù§Ô∏è</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Marck+Script&family=Nunito:wght@400;700&display=swap');

        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            overflow: hidden;
            /* –ù–µ–∂–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç: –†–∞—Å—Å–≤–µ—Ç */
            background: linear-gradient(to bottom, #fff1eb 0%, #ace0f9 100%);
            font-family: 'Nunito', sans-serif;
            touch-action: none; 
        }

        /* –û–±–ª–∞–∫–∞ –Ω–∞ —Ñ–æ–Ω–µ */
        .cloud {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            opacity: 0.6;
            animation: floatCloud linear infinite;
            z-index: 0;
        }

        @keyframes floatCloud {
            from { transform: translateX(-200px); }
            to { transform: translateX(110vw); }
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none;
        }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            z-index: 10;
            display: flex;
            justify-content: center;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        #progress-container {
            width: 300px;
            height: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            border: 3px solid #ff9a9e;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff9a9e, #fad0c4);
            transition: width 0.4s ease-out;
        }

        #progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 20px;
            font-size: 14px;
            color: #d6336c;
            font-weight: bold;
            top: 0;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            transition: opacity 0.8s, visibility 0.8s;
            padding: 20px;
            text-align: center;
        }

        .hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        h1 {
            font-family: 'Marck Script', cursive;
            font-size: 3.5rem;
            color: #d6336c;
            margin-bottom: 10px;
        }

        p {
            font-size: 1.2rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 30px;
            max-width: 500px;
        }

        .btn {
            background: #ff9a9e;
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
            transition: transform 0.2s, background 0.2s;
            font-family: 'Nunito', sans-serif;
            font-weight: bold;
        }

        .btn:active {
            transform: scale(0.95);
        }
        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –£—Ä–æ–≤–Ω—è 2 (–ö–ª–∏–∫ –ø–æ —Å–µ—Ä–¥—Ü—É) --- */
        #heart-btn {
            font-size: 8rem;
            padding: 60px 100px;
            
            background: none;
            border: none;
            cursor: pointer;
            animation: heartbeat 1.5s infinite;
            transition: transform 0.1s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            text-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            
            touch-action: manipulation; 
        }

        #heart-btn:active {
            transform: scale(0.9) !important;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* --- –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ --- */
        #win-screen {
            background: rgba(0, 0, 0, 0.3); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω, —á—Ç–æ–±—ã —Å–∞–ª—é—Ç –±—ã–ª —è—Ä—á–µ */
        }

        .letter-card {
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            border: 2px dashed #ff9a9e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 600px;
            transform: translateY(20px);
            opacity: 0;
            transition: all 1s ease 0.5s;
            position: relative;
            z-index: 30;
        }
        
        .letter-card.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* –ß–∞—Å—Ç–∏—Ü—ã —Ç—É–º–∞–Ω–∞ */
        .mist-particle {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(255, 0, 50, 0.8) 0%, rgba(255, 0, 0, 0) 70%);
            border-radius: 50%;
            filter: blur(15px); 
            pointer-events: none;
            z-index: 40; 
            transform: translate(-50%, -50%);
            animation: mistFloat 1s ease-out forwards;
        }

        @keyframes mistFloat {
            0% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 0;
                /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ --tx –∏ --ty –º—ã –∑–∞–¥–∞–¥–∏–º –≤ JS –¥–ª—è —Ä–∞–∑–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(2.5);
            }
        }

        /* –ö–ª–∞—Å—Å –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Ö–æ–ª—Å—Ç–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .fade-out-game {
            opacity: 0;
            transition: opacity 1.5s ease-in-out; /* –ü–ª–∞–≤–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –∑–∞ 1.5 —Å–µ–∫—É–Ω–¥—ã */
            pointer-events: none; /* –ß—Ç–æ–±—ã –Ω–µ–ª—å–∑—è –±—ã–ª–æ –Ω–∞–∂–∏–º–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è */
        }

        /* –ö–ª–∞—Å—Å –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .fade-in-level {
            animation: fadeInLevel 1.5s forwards;
        }

        @keyframes fadeInLevel {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

    </style>
</head>
<body>

    <!-- –î–µ–∫–æ—Ä: –æ–±–ª–∞–∫–∞ -->
    <div id="clouds"></div>

    <!-- UI –£—Ä–æ–≤–Ω—è 1 -->
    <div id="ui-layer">
        <div id="progress-container">
            <div id="progress-fill"></div>
            <div id="progress-text">–°–æ–±–∏—Ä–∞–µ–º –ª—é–±–æ–≤—å... 0%</div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
    <div id="start-screen" class="overlay">
        <h1>–ö—Ä–∏—Å—Ç–∏–Ω—á–∏–∫...</h1>
        <p>–Ø —Å–¥–µ–ª–∞–ª —ç—Ç—É –∏–≥—Ä—É-–æ—Ç–∫—Ä—ã—Ç–∫—É, —á—Ç–æ–±—ã —Ç—ã —É–ª—ã–±–Ω—É–ª–∞—Å—å.<br>
        –ù–∞ –ø–µ—Ä–≤–æ–º —É—Ä–æ–≤–Ω–µ: –ª–æ–≤–∏ –º–∏–ª–∞—à–Ω–æ—Å—Ç–∏ –∫–æ—Ä–∑–∏–Ω–∫–æ–π, –Ω–µ —Ç–µ—Ä—è–π –∏—Ö!<br>
        –ì–æ—Ç–æ–≤–∞?</p>
        <button class="btn" onclick="startLevel1()">–ù–∞—á–∞—Ç—å ‚ú®</button>
    </div>

    <!-- –£—Ä–æ–≤–µ–Ω—å 2: –¢–∞–ø–∞–ª–∫–∞ -->
    <div id="level-2-screen" class="overlay hidden">
        <h1>–ü–æ—á—Ç–∏-–ø–æ—á—Ç–∏!</h1>
        <p>–ú–æ—ë —Å–µ—Ä–¥—Ü–µ –±—å–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è.<br>–ù–∞–∂–∏–º–∞–π –Ω–∞ –Ω–µ–≥–æ, —á—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –ª—é–±–æ–≤—å—é!</p>
        <button id="heart-btn" onpointerdown="clickHeart(event)">‚ù§Ô∏è</button>
        <p id="click-counter" style="margin-top: 10px; font-weight: bold; color: #ff758c;">0 / 50</p>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã -->
    <div id="win-screen" class="overlay hidden">
        <div class="letter-card" id="final-letter">
            <h1 style="font-size: 2.5rem;">–ü–æ–±–µ–¥–∞! üéÜ</h1>
            <p style="font-size: 1.3rem; color: #333;">
                –¢—ã —Å–æ–±—Ä–∞–ª–∞ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–∏–∫–∏ –∏ –∑–∞—Å—Ç–∞–≤–∏–ª–∞ –º–æ–µ —Å–µ—Ä–¥—Ü–µ –±–∏—Ç—å—Å—è —á–∞—â–µ.<br><br>
                –≠—Ç–æ—Ç —Å–∞–ª—é—Ç –≤ —Ç–≤–æ—é —á–µ—Å—Ç—å, —Å–æ–ª–Ω—ã—à–∫–æ.<br>
                <b>–° –¥–Ω—ë–º –≤—Å–µ—Ö –≤–ª—é–±–ª–µ–Ω–Ω—ã—Ö!</b>
            </p>
            <p style="font-size: 3rem;">üå∑</p>
        </div>
    </div>

<script>
    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
    const CONFIG = {
        playerEmoji: "üß∫", 
        items: ["‚ù§Ô∏è", "üíñ", "üíû", "üíå", "üå∏", "üß∏", "üç´"], 
        speed: 3.5, 
        targetScore: 33, // –°–∫–æ–ª—å–∫–æ –ø–æ–π–º–∞—Ç—å –Ω–∞ 1 —É—Ä–æ–≤–Ω–µ
        clicksNeeded: 50, // –°–∫–æ–ª—å–∫–æ –∫–ª–∏–∫–æ–≤ –Ω–∞ 2 —É—Ä–æ–≤–Ω–µ
        spawnRate: 40
    };

    const compliments = ["–õ—é–±–ª—é —Ç–≤–æ—é —É–ª—ã–±–∫—É!", "–ú–æ—ë —Å–æ–ª–Ω—ã—à–∫–æ!", "–ú–æ–π –∞–Ω–≥–µ–ª–æ—á–µ–∫!", "–õ—é–±–∏–º–∫–∞!", "–û–±–æ–∂–∞—é —Ç–µ–±—è!", "–ü–æ—Ü–µ–ª—É–π—á–∏–∫!", "–í —â—ë—á–∫—É!", "–ü—Ä–æ—Å—Ç–æ –≤–∞—É!", "–û—á–∞—Ä–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ç—ã!", "–õ—é–±–ª—é —Ç–µ–±—è —Å–ª—É—à–∞—Ç—å!"];
    const clickPhrases = ["–ï—â—ë!", "–°–∏–ª—å–Ω–µ–µ!", "–ñ–º—è–∫-–∂–º—è–∫!", "‚ù§Ô∏è", "–ú—É—Ä!"];
    const sadPhrases = ["–û–π...", "–£–ø–∞–ª–æ üò¢", "–õ–æ–≤–∏!", "–ú–∏–º–æ...", "üíî"];

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø CANVAS ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let width, height;
    
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ---
    let gameState = 'start'; // start, level1, level2, win
    let items = [];
    let floatingTexts = [];
    let fireworks = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Å–∞–ª—é—Ç–∞
    let score = 0;
    let clickScore = 0;
    let playerX = width / 2;

    // --- –û–ë–õ–ê–ö–ê ---
    function createClouds() {
        const container = document.getElementById('clouds');
        for(let i=0; i<5; i++) {
            let cloud = document.createElement('div');
            cloud.classList.add('cloud');
            let w = 100 + Math.random() * 200;
            cloud.style.width = w + 'px';
            cloud.style.height = (w * 0.6) + 'px';
            cloud.style.top = (Math.random() * height * 0.5) + 'px';
            cloud.style.animationDuration = (20 + Math.random() * 40) + 's';
            cloud.style.left = Math.random() * 100 + 'vw';
            container.appendChild(cloud);
        }
    }
    createClouds();

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï (–£—Ä–æ–≤–µ–Ω—å 1) ---
    function onMove(e) {
        if (gameState !== 'level1') return;
        const x = e.touches ? e.touches[0].clientX : e.clientX;
        playerX = x;
    }
    window.addEventListener('mousemove', onMove);
    window.addEventListener('touchmove', onMove);

    // --- –ö–õ–ê–°–°–´ ---
    class Item {
        constructor() {
            this.x = Math.random() * (width - 40) + 20;
            this.y = -50;
            this.emoji = CONFIG.items[Math.floor(Math.random() * CONFIG.items.length)];
            this.speed = Math.random() * 1.5 + 2;
            this.swingOffset = Math.random() * Math.PI * 2;
        }
        update() {
            this.y += this.speed;
            this.x += Math.sin(this.y * 0.02 + this.swingOffset) * 1; 
        }
        draw() {
            ctx.font = "28px Arial";
            ctx.textAlign = "center";
            ctx.fillText(this.emoji, this.x, this.y);
        }
    }

   class FloatingText {
        constructor(x, y, text, color = "#d6336c") {
            this.x = x;
            this.y = y;
            this.text = text;
            this.color = color;
            this.life = 1.0;
            this.dy = -1.5;
        }
        update() {
            this.y += this.dy;
            this.life -= 0.015;
        }
        draw() {
            ctx.save();
            ctx.globalAlpha = Math.max(0, this.life);
            ctx.font = "bold 20px Nunito";
            ctx.fillStyle = this.color;
            ctx.textAlign = "center";
            ctx.strokeStyle = "white"; 
            ctx.lineWidth = 3;
            ctx.strokeText(this.text, this.x, this.y);
            ctx.fillText(this.text, this.x, this.y);
            ctx.restore();
        }
    }

    // --- –ö–õ–ê–°–° –°–ê–õ–Æ–¢–ê ---
    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.color = color;
            // –†–∞–∑–ª–µ—Ç–∞—é—Ç—Å—è –≤–æ –≤—Å–µ —Å—Ç–æ—Ä–æ–Ω—ã
            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 4 + 2;
            this.vx = Math.cos(angle) * velocity;
            this.vy = Math.sin(angle) * velocity;
            this.life = 1.0;
            this.gravity = 0.05;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += this.gravity; // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
            this.vx *= 0.95; // –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞
            this.vy *= 0.95;
            this.life -= 0.01;
        }
        draw() {
            ctx.globalAlpha = Math.max(0, this.life);
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
        }
    }

    function createFirework() {
        const x = Math.random() * width;
        const y = Math.random() * (height / 2); // –í–∑—Ä—ã–≤–∞—é—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏
        const colors = ['#ff9a9e', '#fad0c4', '#ffecd2', '#fcb69f', '#ff758c', '#ffffff'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        for (let i = 0; i < 30; i++) { // 30 —á–∞—Å—Ç–∏—Ü –Ω–∞ –æ–¥–∏–Ω –≤–∑—Ä—ã–≤
            fireworks.push(new Particle(x, y, color));
        }
    }

    function createMistEffect(x, y) {
        const particleCount = 6; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–ª–∞—á–∫–æ–≤ –∑–∞ –æ–¥–∏–Ω –∫–ª–∏–∫
        
        for (let i = 0; i < particleCount; i++) {
            const mist = document.createElement('div');
            mist.classList.add('mist-particle');
            
            mist.style.left = x + 'px';
            mist.style.top = y + 'px';
            
            // –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–ª–µ—Ç–∞
            const angle = Math.random() * Math.PI * 2;
            const velocity = 35 + Math.random() * 100; // –ù–∞—Å–∫–æ–ª—å–∫–æ –¥–∞–ª–µ–∫–æ –ª–µ—Ç–∏—Ç
            
            const tx = Math.cos(angle) * velocity + 'px';
            const ty = Math.sin(angle) * velocity + 'px';
            
            mist.style.setProperty('--tx', tx);
            mist.style.setProperty('--ty', ty);
            
            document.body.appendChild(mist);
            
            setTimeout(() => {
                mist.remove();
            }, 800);
        }
    }

    // --- –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø UI ---
    function updateProgressUI() {
        let percent = Math.max(0, Math.min((score / CONFIG.targetScore) * 100, 100));
        document.getElementById('progress-fill').style.width = percent + "%";
        document.getElementById('progress-text').innerText = `–°–æ–±—Ä–∞–Ω–æ –ª—é–±–≤–∏: ${Math.floor(percent)}%`;
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---

    // 1. –°—Ç–∞—Ä—Ç –£—Ä–æ–≤–Ω—è 1
    function startLevel1() {
        document.getElementById('start-screen').classList.add('hidden');
        gameState = 'level1';
        loop();
    }

    // 2. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –£—Ä–æ–≤–Ω—é 2
    function startLevel2() {
        gameState = 'transition'; 

        const successText = new FloatingText(width, height, "–¢—ã —É–º–Ω–∏—Ü–∞! ‚ù§Ô∏è", "#ff0055");
        successText.life = 2.0;
        successText.dy = -0.5; 
        floatingTexts.push(successText);

        document.getElementById('gameCanvas').classList.add('fade-out-game');
        document.getElementById('ui-layer').classList.add('fade-out-game');

        setTimeout(() => {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            gameState = 'level2';
            
            const c = document.getElementById('gameCanvas');
            c.style.display = 'block'; 
            c.classList.remove('fade-out-game'); 
            c.style.zIndex = "50";

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            const level2 = document.getElementById('level-2-screen');
            level2.classList.remove('hidden');
            level2.classList.add('fade-in-level');

        }, 1500);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å–µ—Ä–¥—Ü—É (–£—Ä–æ–≤–µ–Ω—å 2)
    function clickHeart(e) {
        if (gameState !== 'level2') return;
        
        let x, y;

        if (e && e.clientX) {
            x = e.clientX;
            y = e.clientY;
        } else if (e && e.touches && e.touches[0]) {
            x = e.touches[0].clientX;
            y = e.touches[0].clientY;
        } else {
            const rect = document.getElementById('heart-btn').getBoundingClientRect();
            x = rect.left + rect.width / 2;
            y = rect.top + rect.height / 2 - 40; 
        }
        // ----------------------------------------

        clickScore++;
        document.getElementById('click-counter').innerText = `${clickScore} / ${CONFIG.clicksNeeded}`;
        
        // –°–æ–∑–¥–∞–µ–º —Ç—É–º–∞–Ω —Ç–æ—á–Ω–æ –≤ —Ç–æ—á–∫–µ –∫–∞—Å–∞–Ω–∏—è (x, y)
        if (Math.random() < 0.75) {
            createMistEffect(x, y);
        } 
        
        if (clickScore >= CONFIG.clicksNeeded / 2) {
            const phrase = clickPhrases[Math.floor(Math.random() * clickPhrases.length)];
            // –¢–µ–∫—Å—Ç —Ç–æ–∂–µ –ø—É—Å–∫–∞–µ–º —Ä—è–¥–æ–º —Å –ø–∞–ª—å—Ü–µ–º
            floatingTexts.push(new FloatingText(x + (Math.random()*60-30), y - 50, phrase));
        }

        if (clickScore >= CONFIG.clicksNeeded) {
            startWin();
        }
    }

    // 3. –§–∏–Ω–∞–ª (–°–∞–ª—é—Ç)
    function startWin() {
        gameState = 'win';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å
        document.getElementById('level-2-screen').classList.add('hidden');
        document.getElementById('level-2-screen').classList.remove('fade-in-level');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã
        document.getElementById('win-screen').classList.remove('hidden');

        const c = document.getElementById('gameCanvas');
        c.style.display = 'block';   
        c.style.opacity = '1';       
        c.classList.remove('fade-out-game');
        c.style.zIndex = "50";      
        
        setTimeout(() => {
            document.getElementById('final-letter').classList.add('show');
        }, 500);
    }

    // --- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ (LOOP) ---
    let frame = 0;
    function loop() {
        requestAnimationFrame(loop);
        ctx.clearRect(0, 0, width, height);

        // –£—Ä–æ–≤–µ–Ω—å 1: –õ–æ–≤–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        if (gameState === 'level1' || gameState === 'transition') {
            frame++;
            if (gameState === 'level1' && frame % CONFIG.spawnRate === 0) items.push(new Item());

            // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
            ctx.font = "44px Arial";
            ctx.textAlign = "center";
            ctx.fillText(CONFIG.playerEmoji, playerX, height - 44);

            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                item.update();
                item.draw();

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                const dist = Math.abs(item.x - playerX);
                const distY = Math.abs(item.y - (height - 44));

                if (dist < 36 && distY < 36) {
                    score++;
                    const phrase = compliments[Math.floor(Math.random() * compliments.length)];
                    floatingTexts.push(new FloatingText(item.x, item.y, phrase));

                    let percent = Math.min((score / CONFIG.targetScore) * 100, 100);
                    document.getElementById('progress-fill').style.width = percent + "%";
                    document.getElementById('progress-text').innerText = `–°–æ–±—Ä–∞–Ω–æ –ª—é–±–≤–∏: ${Math.floor(percent)}%`;

                    items.splice(i, 1);

                    if (score >= CONFIG.targetScore) {
                        startLevel2();
                    }
                } else if (item.y > height) {
                    // // –û—Ç–Ω–∏–º–∞–µ–º –æ—á–∫–∏, –Ω–æ –Ω–µ –º–µ–Ω—å—à–µ 0
                    if (score > 0) score--;
                    
                    // –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç (—Å–∏–Ω–∏–π/—Å–µ—Ä—ã–π)
                    const sadPhrase = sadPhrases[Math.floor(Math.random() * sadPhrases.length)];
                    floatingTexts.push(new FloatingText(item.x, height - 50, sadPhrase, "#020079"));
                    
                    updateProgressUI();
                    items.splice(i, 1);
                }
            }
        }

        // –†–µ–Ω–¥–µ—Ä –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–¥–ª—è –æ–±–æ–∏—Ö —É—Ä–æ–≤–Ω–µ–π)
        for (let i = floatingTexts.length - 1; i >= 0; i--) {
            let ft = floatingTexts[i];
            ft.update();
            ft.draw();
            if (ft.life <= 0) floatingTexts.splice(i, 1);
        }

        // –£—Ä–æ–≤–µ–Ω—å –ü–æ–±–µ–¥—ã: –°–∞–ª—é—Ç
        if (gameState === 'win') {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Å–∞–ª—é—Ç—ã —Å–ª—É—á–∞–π–Ω–æ
            if (Math.random() < 0.07) { // –®–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–∞–ª—é—Ç–∞ –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
                createFirework();
            }

            for (let i = fireworks.length - 1; i >= 0; i--) {
                let p = fireworks[i];
                p.update();
                p.draw();
                if (p.life <= 0) fireworks.splice(i, 1);
            }
        }
    }

</script>
</body>
</html>